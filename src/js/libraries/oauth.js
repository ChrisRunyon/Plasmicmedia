var OAuth;null==OAuth&&(OAuth={}),OAuth.setProperties=function(into,from){if(null!=into&&null!=from)for(var key in from)into[key]=from[key];return into},OAuth.setProperties(OAuth,{percentEncode:function percentEncode(s){if(null==s)return"";if(s instanceof Array){for(var e="",i=0;i<s.length;++s)""!=e&&(e+="&"),e+=percentEncode(s[i]);return e}return s=encodeURIComponent(s),s=s.replace(/\!/g,"%21"),s=s.replace(/\*/g,"%2A"),s=s.replace(/\'/g,"%27"),s=s.replace(/\(/g,"%28"),s=s.replace(/\)/g,"%29")},decodePercent:function(s){return null!=s&&(s=s.replace(/\+/g," ")),decodeURIComponent(s)},getParameterList:function(parameters){if(null==parameters)return[];if("object"!=typeof parameters)return decodeForm(parameters+"");if(parameters instanceof Array)return parameters;var list=[];for(var p in parameters)list.push([p,parameters[p]]);return list},getParameterMap:function getParameterMap(parameters){if(null==parameters)return{};if("object"!=typeof parameters)return getParameterMap(decodeForm(parameters+""));if(parameters instanceof Array){for(var map={},p=0;p<parameters.length;++p){var key=parameters[p][0];void 0===map[key]&&(map[key]=parameters[p][1])}return map}return parameters},getParameter:function(parameters,name){if(!(parameters instanceof Array))return OAuth.getParameterMap(parameters)[name];for(var p=0;p<parameters.length;++p)if(parameters[p][0]==name)return parameters[p][1];return null},formEncode:function(parameters){for(var form="",list=OAuth.getParameterList(parameters),p=0;p<list.length;++p){var value=list[p][1];null==value&&(value=""),""!=form&&(form+="&"),form+=OAuth.percentEncode(list[p][0])+"="+OAuth.percentEncode(value)}return form},decodeForm:function(form){for(var list=[],nvps=form.split("&"),n=0;n<nvps.length;++n){var nvp=nvps[n];if(""!=nvp){var name,value,equals=nvp.indexOf("=");0>equals?(name=OAuth.decodePercent(nvp),value=null):(name=OAuth.decodePercent(nvp.substring(0,equals)),value=OAuth.decodePercent(nvp.substring(equals+1))),list.push([name,value])}}return list},setParameter:function(message,name,value){var parameters=message.parameters;if(parameters instanceof Array){for(var p=0;p<parameters.length;++p)parameters[p][0]==name&&(void 0===value?parameters.splice(p,1):(parameters[p][1]=value,value=void 0));void 0!==value&&parameters.push([name,value])}else parameters=OAuth.getParameterMap(parameters),parameters[name]=value,message.parameters=parameters},setParameters:function(message,parameters){for(var list=OAuth.getParameterList(parameters),i=0;i<list.length;++i)OAuth.setParameter(message,list[i][0],list[i][1])},completeRequest:function(message,accessor){null==message.method&&(message.method="GET");var map=OAuth.getParameterMap(message.parameters);null==map.oauth_consumer_key&&OAuth.setParameter(message,"oauth_consumer_key",accessor.consumerKey||""),null==map.oauth_token&&null!=accessor.token&&OAuth.setParameter(message,"oauth_token",accessor.token),null==map.oauth_version&&OAuth.setParameter(message,"oauth_version","1.0"),null==map.oauth_timestamp&&OAuth.setParameter(message,"oauth_timestamp",OAuth.timestamp()),null==map.oauth_nonce&&OAuth.setParameter(message,"oauth_nonce",OAuth.nonce(6)),OAuth.SignatureMethod.sign(message,accessor)},setTimestampAndNonce:function(message){OAuth.setParameter(message,"oauth_timestamp",OAuth.timestamp()),OAuth.setParameter(message,"oauth_nonce",OAuth.nonce(6))},addToURL:function(url,parameters){if(newURL=url,null!=parameters){var toAdd=OAuth.formEncode(parameters);if(toAdd.length>0){var q=url.indexOf("?");0>q?newURL+="?":newURL+="&",newURL+=toAdd}}return newURL},getAuthorizationHeader:function(realm,parameters){for(var header='OAuth realm="'+OAuth.percentEncode(realm)+'"',list=OAuth.getParameterList(parameters),p=0;p<list.length;++p){var parameter=list[p],name=parameter[0];0==name.indexOf("oauth_")&&(header+=","+OAuth.percentEncode(name)+'="'+OAuth.percentEncode(parameter[1])+'"')}return header},timestamp:function(){var d=new Date;return Math.floor(d.getTime()/1e3)},nonce:function(length){for(var chars=OAuth.nonce.CHARS,result="",i=0;length>i;++i){var rnum=Math.floor(Math.random()*chars.length);result+=chars.substring(rnum,rnum+1)}return result}}),OAuth.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",OAuth.declareClass=function(parent,name,newConstructor){var previous=parent[name];if(parent[name]=newConstructor,null!=newConstructor&&null!=previous)for(var key in previous)"prototype"!=key&&(newConstructor[key]=previous[key]);return newConstructor},OAuth.declareClass(OAuth,"SignatureMethod",function(){}),OAuth.setProperties(OAuth.SignatureMethod.prototype,{sign:function(message){var baseString=OAuth.SignatureMethod.getBaseString(message),signature=this.getSignature(baseString);return OAuth.setParameter(message,"oauth_signature",signature),signature},initialize:function(name,accessor){var consumerSecret;consumerSecret=null!=accessor.accessorSecret&&name.length>9&&"-Accessor"==name.substring(name.length-9)?accessor.accessorSecret:accessor.consumerSecret,this.key=OAuth.percentEncode(consumerSecret)+"&"+OAuth.percentEncode(accessor.tokenSecret)}}),OAuth.setProperties(OAuth.SignatureMethod,{sign:function(message,accessor){var name=OAuth.getParameterMap(message.parameters).oauth_signature_method;(null==name||""==name)&&(name="HMAC-SHA1",OAuth.setParameter(message,"oauth_signature_method",name)),OAuth.SignatureMethod.newMethod(name,accessor).sign(message)},newMethod:function(name,accessor){var impl=OAuth.SignatureMethod.REGISTERED[name];if(null!=impl){var method=new impl;return method.initialize(name,accessor),method}var err=new Error("signature_method_rejected"),acceptable="";for(var r in OAuth.SignatureMethod.REGISTERED)""!=acceptable&&(acceptable+="&"),acceptable+=OAuth.percentEncode(r);throw err.oauth_acceptable_signature_methods=acceptable,err},REGISTERED:{},registerMethodClass:function(names,classConstructor){for(var n=0;n<names.length;++n)OAuth.SignatureMethod.REGISTERED[names[n]]=classConstructor},makeSubclass:function(getSignatureFunction){var superClass=OAuth.SignatureMethod,subClass=function(){superClass.call(this)};return subClass.prototype=new superClass,subClass.prototype.getSignature=getSignatureFunction,subClass.prototype.constructor=subClass,subClass},getBaseString:function(message){var parameters,URL=message.action,q=URL.indexOf("?");if(0>q)parameters=message.parameters;else{parameters=OAuth.decodeForm(URL.substring(q+1));for(var toAdd=OAuth.getParameterList(message.parameters),a=0;a<toAdd.length;++a)parameters.push(toAdd[a])}return OAuth.percentEncode(message.method.toUpperCase())+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(URL))+"&"+OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(parameters))},normalizeUrl:function(url){var uri=OAuth.SignatureMethod.parseUri(url),scheme=uri.protocol.toLowerCase(),authority=uri.authority.toLowerCase(),dropPort="http"==scheme&&80==uri.port||"https"==scheme&&443==uri.port;if(dropPort){var index=authority.lastIndexOf(":");index>=0&&(authority=authority.substring(0,index))}var path=uri.path;return path||(path="/"),scheme+"://"+authority+path},parseUri:function(str){for(var o={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser.strict.exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri},normalizeParameters:function(parameters){if(null==parameters)return"";for(var list=OAuth.getParameterList(parameters),sortable=[],p=0;p<list.length;++p){var nvp=list[p];"oauth_signature"!=nvp[0]&&sortable.push([OAuth.percentEncode(nvp[0])+" "+OAuth.percentEncode(nvp[1]),nvp])}sortable.sort(function(a,b){return a[0]<b[0]?-1:a[0]>b[0]?1:0});for(var sorted=[],s=0;s<sortable.length;++s)sorted.push(sortable[s][1]);return OAuth.formEncode(sorted)}}),OAuth.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],OAuth.SignatureMethod.makeSubclass(function(baseString){return this.key})),OAuth.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],OAuth.SignatureMethod.makeSubclass(function(baseString){b64pad="=";var signature=b64_hmac_sha1(this.key,baseString);return signature}));